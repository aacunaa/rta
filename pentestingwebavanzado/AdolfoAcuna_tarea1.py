from burp import IBurpExtender, IHttpListener
import re

class BurpExtender(IBurpExtender, IHttpListener):
  def registerExtenderCallbacks(self, callbacks):
    self._callbacks = callbacks
    self._helpers = callbacks.getHelpers()
    callbacks.registerHttpListener(self)
    callbacks.setExtensionName("Respuesta-busqueda")

  def getResponseHeadersAndBody(self, content):
    response = content.getResponse()
    response_data = self._helpers.analyzeResponse(response)
    headers = list(response_data.getHeaders() or '')
    body = response[response_data.getBodyOffset():].tostring()
    return headers, body

  def processHttpMessage(self, tool, is_request, content):
    if is_request:
      return
    headers, body = self.getResponseHeadersAndBody(content)
    #print(body)

    if ".css" in str(body):
      #regex = r"https?://(?:[-\w.]|(?:%[\da-fA-F]{2}))+\.css(?:[-\w./?%&=]*)?"
      #regex2 = r'https?:\/\/(?:[^\/]+\.)?.*\.css(?:\?.*)?$'
      urls = re.findall('href=["\']?([^"\'>]+\.css)', str(body))
      #urls = re.findall(regex, str(body))
      for url in urls:
        print("Archivo CSS encontrado:", url)
